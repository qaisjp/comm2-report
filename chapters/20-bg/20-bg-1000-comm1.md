\chapter{Background}

# The existing platform

The existing platform^[https://community.mtasa.com] was written for the MTA:SA community in 2006 by Stanislav Bobrov and other contributors.
Throughout the rest of this report, the existing work will be referred to as _comm1_, short for "community 1.0".

## Features

In this section I describe all the features and pages that _comm1_ has.

All pages on the website, in terms of visual design, follow a consistent template:

- country flags to change translation, when clicked, change the interface's language for the remainder of the active PHP session
- a sidebar
- the top navigation icons
    - when logged out: has links to the "Home", "Register", "Login" and "Resources" pages, and an external link to the game's forum
- three top navigation icons "groups", "resources" and "servers"; leading to their respective pages on the platform
- a navigation bar
    - when logged out: has links to "Register" and "Login"
    - when logged in: has links to "My View" (the user's profile), "Admin Panel" (if the user is an administrator), "Download MTA:SA" (an external link), and "Logout (foo)" (with `foo` replaced with the user's username)

**Translation**

The translation system

TODO:

- describe how it works
- uses GET parameter `set_lang`, which is NOT RESTful
- the code internals are horrible, using something like `text_item[2]` with numbers increasing for each string

**URL design**

All pages on the website are produced by the `index.php` script. The active page is indicated by a GET parameters in the query string. One example of a page's `Path` is: `/index.php?p=stats&show=vehicles&id=254572`.

The `p` parameter stands for "page" and usually describes the top-level module. Each module tends to handle submodules in their own way.

### Homepage (`?p=main`)

The homepage contains a short description of what the system is for and also a link to the resources page titled "Latest resources",
with a preview of 100 most recently uploaded resources underneath. Only resources that fit the following criteria will be shown:

- must be 'active' (not 'suspended' or 'pending')
- must have pictures in the gallery
- must not be marked as 'not safe for work'

At the bottom of the page there are also pagination buttons. These pagination buttons simply submit a form that refreshes the page
whilst also incrementing or decrementing the `oset` query string parameter by 100.

If the `oset` query parameter is `0` (or missing, as it is when you initially visit the page),
no pagination buttons are shown and only a single "MORE.." button is shown.
The `oset` parameter is not capped, and can go as far as the earliest resource that fits the above criteria.

If the `oset` parameter goes beyond the number of potentially viewable results, no resources will be shown, and the pagination
buttons will still be enabled. This is considered to be poor user experience (UX) as a user may not know that they have reached the end of the list, and may attempt
to keep click "Next" in the attempt to show more items. In practice, a user most likely will not click through seventy pages of pictures, so this pagination
feature can be considered unnecessary.

!["Latest resources" section on the homepage](chapters/20-bg/assets/comm1-resources.png)

### Resources (`?p=resources&)

### Auth

## Issues

### Low quality resources

### Missing report feature

### Spam accounts

### Abandoned social features

- Non-standard authentication system caused integration with other systems to be abandoned

### Security issues

- Vulnerable to CSRF attacks in some cases
- Resources do not have a concept of "creators" and "collaborators", only "owners". All owners have equal permissions, meaning that a resource can be hijacked and stolen from its creator by a rogue collaborator.

### Other minor issues

Attempting to log in with invalid credentials will show useless errors like "Invalid user id"

## Resources scoping

Resources are currently scoped to a global level. There is no way to upload a resource if there already exists a resource with the same name.

This is susceptible to "squatting", so we checked to see if there are any user accounts that appear to squat a large number of resources.

We first ran the following query to get the list of users that own at least twenty resources.

```sql
with owners as (
    select owner_id, count(owner_id) as freq
    from resource_owners
    group by owner_id
    having count(owner_id) > 20
    order by freq desc
)
```

This allowed us to run a number of additional queries to find more detailed information. The information below is public, and therefore _not_ anonymised.

**Usernames, IDs and frequency of uploaded resources**

```sql
select users.id, users.username, owners.freq
from owners, users
where users.id = owners.owner_id;
```

| id     | username           | freq | description
| -------| ------------------ | ---- | -----------
| 401291 | _Lorimaxxx_        | 131  | racing maps                          <!-- https://community.mtasa.com/index.php?p=profile&id=401291 -->
| 399788 | _4VCI.SincaN.Pro._ | 82   | racing maps                          <!-- https://community.mtasa.com/index.php?p=profile&id=399788 -->
| 386833 | _Mapper.Creed_     | 82   | racing maps                          <!-- https://community.mtasa.com/index.php?p=profile&id=386833 -->
| 414347 | _MartinPanZycia_   | 80   | unique misc scripts (all Polish)     <!-- https://community.mtasa.com/index.php?p=profile&id=414347 -->
| 416671 | _Reiko:_           | 61   | racing maps                          <!-- https://community.mtasa.com/index.php?p=profile&id=416671 -->
| 320386 | _Ren712_           | 53   | unique misc scripts, shaders         <!-- https://community.mtasa.com/index.php?p=profile&id=320386 -->
| 386795 | _[k.r.a.l.]baris_  | 49   | unique misc scripts (all Turkish)    <!-- https://community.mtasa.com/index.php?p=profile&id=386795 -->
| 356346 | _ByCasinoTR_       | 47   | racing maps                          <!-- https://community.mtasa.com/index.php?p=profile&id=356346 -->
| 347609 | _Dutchman101_      | 44   | unique misc scripts                  <!-- https://community.mtasa.com/index.php?p=profile&id=347609 -->
| 281213 | _ATODOHACK_        | 43   | unique misc scripts (all Spanish)    <!-- https://community.mtasa.com/index.php?p=profile&id=281213 -->

: Top ten resource authors with a brief description of the kinds of resource that each user has uploaded.
Descriptions have been produced by glancing at resource descriptions, and not programmatically. {#tbl:bg-top10-authors}

From [@tbl:bg-top10-authors], we can deduce that the top authors are useful contributors to the platform. We can also see active contributions

When we look further into the leading user account (id 401291) we can see many similar uploads of a similar format, but containing unique content.
Most resource names follow a scheme, incrementing sequentially from `racemap1` to `racemap129`. This _can_ be seen as abusive behaviour, but we determined
this to be non-malicious as each upload is unique: unique resource content, similar but unique useful information, and even gallery uploads.

**Summary**

The analysis above and in {@sec:bg-api-analysis} suggests that "resource squatting" is not a serious issue in our community, allowing us to scope resources to a global level.

TODO: this summary should _perhaps_ not be in the background section.
